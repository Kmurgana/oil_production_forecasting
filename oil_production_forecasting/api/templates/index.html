<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oil Production Forecast</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style id="theme-style">
        body {
            background-color: #f8f9fa;
            padding-top: 50px;
            color: #212529;
        }
        .container {
            max-width: 700px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .form-label {
            font-weight: bold;
        }
        .btn-primary {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
        .result {
            margin-top: 20px;
        }
        #forecastChart {
            margin-top: 30px;
            background: transparent;
        }
        .input-table th, .input-table td {
            text-align: center;
        }
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 30px;
            z-index: 99;
        }
        .reset-btn {
            width: 100%;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<button class="btn btn-secondary theme-toggle" onclick="toggleTheme()">üåì Toggle Theme</button>
<div class="container position-relative">
    <h2 class="mb-4 text-center">üõ¢Ô∏è Oil Production Forecast</h2>
    <form id="forecastForm" action="/predict" method="post" autocomplete="off">
        <table class="table table-bordered input-table">
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>t-3</th>
                    <th>t-2</th>
                    <th>t-1</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Production (MBBL/D)</th>
                    {% for t, default in [(3, 3075), (2, 3080), (1, 3090)] %}
                    <td>
                        <input class="form-control" type="number" step="any" name="prod_{{t}}" value="{{ defaults['prod_' ~ t] if defaults else default }}" required>
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    <th>Rolling Mean (3 periods)</th>
                    {% for t, default in [(3, 3081), (2, 3082), (1, 3085)] %}
                    <td>
                        <input class="form-control" type="number" step="any" name="rolling_mean_3_{{t}}" value="{{ defaults['rolling_mean_3_' ~ t] if defaults else default }}" required>
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    <th>Month</th>
                    {% for t, default in [(3, 4), (2, 4), (1, 4)] %}
                    <td>
                        <input class="form-control" type="number" name="month_{{t}}" value="{{ defaults['month_' ~ t] if defaults else default }}" required>
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    <th>Quarter</th>
                    {% for t, default in [(3, 2), (2, 2), (1, 2)] %}
                    <td>
                        <input class="form-control" type="number" name="quarter_{{t}}" value="{{ defaults['quarter_' ~ t] if defaults else default }}" required>
                    </td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>
        <button class="btn btn-primary" type="submit">üöÄ Predict</button>
        <button type="button" class="btn btn-outline-secondary reset-btn" onclick="resetFormAndChart()">üîÑ Reset</button>
    </form>

    {% if prediction %}
        <div class="alert alert-success result text-center" role="alert">
            <h4 class="alert-heading">üìà Forecast Result</h4>
            <p class="mb-0">Predicted MBBL/D: <strong>{{ prediction }}</strong></p>
        </div>
    {% elif error %}
        <div class="alert alert-danger result text-center" role="alert">
            <h4 class="alert-heading">‚ö†Ô∏è Error</h4>
            <p class="mb-0">{{ error }}</p>
        </div>
    {% endif %}

    {% if chart_labels and chart_values %}
    <div id="forecastChartContainer">
        <canvas id="forecastChart" width="600" height="300"></canvas>
    </div>
    <script>
        let forecastChart = null;
        function renderChart() {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            if (forecastChart) {
                forecastChart.destroy();
            }
            const labels = {{ chart_labels|tojson }};
            const values = {{ chart_values|tojson }};
            forecastChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Historical MBBL/D',
                            data: values.slice(0, -1),
                            fill: false,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.2,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgba(54, 162, 235, 1)'
                        },
                        {
                            label: 'Prediction',
                            data: [null, null, null, values[values.length - 1]],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255,99,132,1)',
                            pointStyle: 'circle',
                            pointRadius: [0,0,0,8],
                            pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                            borderDash: [6,3],
                            fill: false,
                            tension: 0.2,
                            showLine: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Production Forecast (MBBL/D)' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Period' } },
                        y: { title: { display: true, text: 'MBBL/D' }, beginAtZero: false }
                    }
                }
            });
        }
        renderChart();
    </script>
    {% endif %}
</div>

<script>
function toggleTheme() {
    const themeStyle = document.getElementById('theme-style');
    if (!themeStyle) return;
    if (themeStyle.innerHTML.includes('background-color: #f8f9fa;')) {
        // Switch to dark
        themeStyle.innerHTML = `
            body {
                background-color: #181a1b;
                padding-top: 50px;
                color: #f8f9fa;
            }
            .container {
                max-width: 700px;
                background: #23272b;
                color: #f8f9fa;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0,0,0,0.2);
            }
            .form-label {
                font-weight: bold;
                color: #f8f9fa;
            }
            .btn-primary {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
            .result {
                margin-top: 20px;
            }
            #forecastChart {
                margin-top: 30px;
                background: transparent;
            }
            .input-table th, .input-table td {
                text-align: center;
            }
        `;
        localStorage.setItem("theme", "dark");
    } else {
        // Switch to light
        themeStyle.innerHTML = `
            body {
                background-color: #f8f9fa;
                padding-top: 50px;
                color: #212529;
            }
            .container {
                max-width: 700px;
                background: white;
                color: #212529;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
            }
            .form-label {
                font-weight: bold;
                color: #212529;
            }
            .btn-primary {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
            .result {
                margin-top: 20px;
            }
            #forecastChart {
                margin-top: 30px;
                background: transparent;
            }
            .input-table th, .input-table td {
                text-align: center;
            }
        `;
        localStorage.setItem("theme", "light");
    }
}

window.onload = function() {
    // Set initial theme
    const theme = localStorage.getItem("theme") || "light";
    if (theme === "dark") toggleTheme();
};

function resetFormAndChart() {
    document.getElementById("forecastForm").reset();
    // Remove chart if it exists
    if (window.forecastChart) {
        window.forecastChart.destroy();
        window.forecastChart = null;
    }
    // Also remove chart container if you want:
    const chartContainer = document.getElementById("forecastChartContainer");
    if (chartContainer) {
        chartContainer.innerHTML = "";
    }
    // Optionally reload page to get new default values
    // location.reload();
}
</script>

</body>
</html>
